{% load template_func %}

<script>
    {% block javascript %}
        var nuzz = "";
        //var amount = $(this).next().val();
        //amount -= 5;
        {% for comment in comments|slice:"1" %}
            nuzz = "{{ comment.distance_from_sourse }}";
        {% endfor %}
        var loop = $(".loop_num").val();
        var index = (10 * parseInt(nuzz)) - 10;
        var times = 0;
        $(".iii").css("padding-left", index + "%");

        $(".more-comments").click(function() {
            // TODO: Fix bug that the button reveals comments on the post below it
            // TODO: Make that button doesnt reveal all comments on a posific comment
            // TODO: Implement that button only reveals the next 10 comments and than 10 after
            var pk = $(this).siblings(".comments").val();
            // console.log(commentShow);
            if (times % 2 == 0) {
                $(".comment-of-" + pk).css("display", "block").css("padding-left", index + "%");
                console.log(pk);
                $(this).html(
                        'Hide Old Comments'
                );
            } else {
                $(".comment-of-" + pk).css("display", "none").css("padding-left", index + "%");
                $(".last-5").css("display", "block").css("padding-left", index + "%");
                console.log(pk);
                $(this).html(
                        'Show Earlier Comments'
                );
            }
            times++;
        });


    {% endblock %}
</script>

{% last_5_comments comments loop as last_5 %}
{% if comments|length > 5 %}
    <button class="btn-warning more-comments">Show Earlier Comments</button>
    {% with comments|first as first_comment %}
        <input type="hidden" class="comments" value="{{ first_comment.comment.pk }}">
    {% endwith %}
{% endif %}
{% for comment in comments %}
    <div class="iii comment-of-{{ comment.comment.pk }} {% if comment in last_5 %}last-5{% endif %}" id="iii-{{ comment.pk }}" {% if comment not in last_5 %}style="display: none"{% endif %}>
        <input type="hidden" class="iii-pk" value="{{ comment.pk }}">
    <div class="post">

        <p>
            <img src="{{ comment.user.picture.url }}" class="profile_pic"/>
            <a href="" class="name">{{ comment.user }}</a> {{ comment.text }}
            {% if not comment.image %}
                <button class="reply">Reply</button>
{#                <button class="like-button">Like/Unlike</button>#}

            {% endif %}
        </p>
        {% if comment.image %}
            <img src="{{ comment.image.url }}" class="img-responsive"/>
            <p>
{#                <button class="like-button">Like/Unlike</button>#}
                <button class="reply">Reply</button>
            </p>
        {% endif %}

        <p class="likes" style="display: none">{{ comment.amount_likes }} likes </p>
        {% if request.user == False %}
        <form method="post" class="like-unlike-form" id="like-form-{{ comment.pk }}"
              action="{% url 'chat:like/unlike' %}">
            {% csrf_token %}
            <input type="hidden" name="pk" class="pk" value="{{ comment.pk }}">
            <input type="hidden" name="like-amount" class="like-amount" value="{{ comment.amount_likes}}">
            <input type="submit" class="like" value="Like/unlike">
        </form>
        {% endif %}

        <form class="form-inline comment-form reply-form" id="comment-form-{{ comment.pk }}" method="POST"
              action="{% url 'chat:post_comment' %}"
              enctype="multipart/form-data" style="display: none;">
            {% csrf_token %}
            <input type="text" name="text" id="text" placeholder="text"
                   value="{{ request.GET.text }}"/>
            <div class="image-field">
                {# // image input goes here added in jquery when press the camera button #}
            </div>
            <button class="btn-danger hidden-items image-link">X</button>
            <button class="btn-info image-link" id="image-button">
                <i class="fa fa-camera-retro fa-1.5x image-link" aria-hidden="true"></i>
            </button>
            <input type="hidden" name="pk" id="pk" value="{{ comment.pk }}">
            <input type="hidden" class="type" name="type" value="public">
            <input type="submit" class="btn btn-primary submit-comment" value="Reply"/>
        </form>
        <div class="iii new-post" id="new-post-{{ post.pk }}"></div>
    </div>


        {% new_distance comment.distance_from_sourse as distance %}
        {% has_comments comment distance as comments %}
        {% if comments %}

            <button class="btn-info show_replies">Show replies</button>


            <div class="hidden-items">
                <button class="btn-success hide-replies">Hide replies</button>
                {% comments_list comments %}
            </div>
        {% endif %}
    </div>
{% endfor %}
