{% extends "layout.html" %}

<script>
    {% block javascript %}
        $(".message_seen").click(function(event) {
            event.preventDefault();
            var numbbb = parseInt($(this).prevAll(".message_pk").val());
            var data = {
                message_pk: numbbb,
            };
            $.ajax({
                type: "GET",
                url: "{% url 'chat:message_seen' %}",
                data: data,
                success: function (data) {
                    $("#message_" + numbbb).fadeOut().parents("#message_box").fadeOut();
                },
                error: function (responce, error) {
                    alert("Didn' t Go");
                    $("#message_" + numbbb).submit();
                }

            })

        });

        $(".confirm_friend").click(function(event) {
            event.preventDefault();
            var numbbb = parseInt($(this).prevAll("input[type='hidden']").val());
            var data = {
                message_pk: numbbb,
            };
            alert(numbbb);
            $.ajax({
                type: "GET",
                url: "{% url 'chat:confirm_friend' %}",
                data: data,
                success: function (data) {
                    $("#friend_request_" + numbbb).fadeOut();
                },
                error: function (responce, error) {
                    alert("Didn' t Go");
                    $("#friend_request_" + numbbb).submit();
                }

            })

        });
    {% endblock %}
</script>

{% block title %}Messages{% endblock %}

{% block content %}


        {% if user_messages %}
        {% for message in user_messages %}

            <div class="thumbnail" id="message-box">
            <div class="caption">
                {% if message.title == "Friend Request" %}
                    <form id="friend_request_{{ message.pk }}" method="get" action="{% url 'chat:confirm_friend'%}">

                        <input type="hidden" class="message_pk" value="{{ message.pk }}" name="message_pk">
                        <h3>Friend Request from {{ message.from_user }}</h3>
                        <p>{{ message.from_user }} requested that you should be his friend. BY accepting You will see all his chats and he will yours</p>
                        <input type="submit" class="btn btn-primary confirm_friend" role="button" value="Accept Friend Reqeust!">
                    </form>
                {% else %}
                    <form id="message_{{ message.pk }}" method="get" action="{% url 'chat:message_seen'%}">

                        <input type="hidden" class="message_pk" value="{{ message.pk }}" name="message_pk">
                        {% if message.title == "Friend Accepted" %}
                            <h3>Friend Request accepted from {{ message.from_user }}</h3>
                            <p>{{ message.from_user }} accepted your friend requested. Now you will see all his chats and he will see yours.</p>
                        {% else %}
                            <h3>{{ message.title}}</h3>
                            {% if message.message %}
                                <p>{{ message.message }}</p>
                            {% endif %}
                            <p>from <strong><a href="#">{{ message.from_user }}</a></strong></p>
                        {% endif %}
                        <input type="submit" class="btn btn-primary message_seen" role="button" value="X">
                    </form>

                {% endif %}
            </div>
            </div>
        {% endfor %}
        {% else %}
            <h3> Sorry no messages</h3>
        {% endif %}
{% endblock %}